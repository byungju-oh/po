{% extends "base.html" %}

{% block title %}ìƒˆ ì‘í’ˆ ì¶”ê°€ - ê´€ë¦¬ì{% endblock %}

{% block content %}
<div class="container mt-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="h2 mb-1">ìƒˆ ì‘í’ˆ ì¶”ê°€</h1>
                    <p class="text-muted mb-0">í¬íŠ¸í´ë¦¬ì˜¤ì— ìƒˆë¡œìš´ ì‘í’ˆì„ ì¶”ê°€í•´ë³´ì„¸ìš”</p>
                </div>
                <a href="{{ url_for('admin') }}" class="btn btn-outline-secondary">
                    <i class="fas fa-arrow-left me-1"></i>ê´€ë¦¬ìë¡œ ëŒì•„ê°€ê¸°
                </a>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Form -->
        <div class="col-lg-8">
            <div class="card shadow">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-plus me-2"></i>ì‘í’ˆ ì •ë³´ ì…ë ¥
                    </h5>
                </div>
                <div class="card-body">
                    <form id="addWorkForm" method="POST" enctype="multipart/form-data" action="{{ url_for('add_work') }}">
                        <!-- ê¸°ë³¸ ì •ë³´ -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h6 class="text-primary mb-3">
                                    <i class="fas fa-info-circle me-1"></i>ê¸°ë³¸ ì •ë³´
                                </h6>
                            </div>
                            <div class="col-md-8 mb-3">
                                <label for="title" class="form-label">ì‘í’ˆëª… *</label>
                                <input type="text" class="form-control" id="title" name="title" 
                                       placeholder="ì‘í’ˆì˜ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                                <div class="form-text">ì‚¬ìš©ìì—ê²Œ í‘œì‹œë  ì‘í’ˆì˜ ì œëª©ì…ë‹ˆë‹¤.</div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="category" class="form-label">ì¹´í…Œê³ ë¦¬</label>
                                <select class="form-select" id="category" name="category">
                                    <option value="">ì¹´í…Œê³ ë¦¬ ì„ íƒ</option>
                                    <option value="í’ê²½í™”">í’ê²½í™”</option>
                                    <option value="ì¸ë¬¼í™”">ì¸ë¬¼í™”</option>
                                    <option value="ì •ë¬¼í™”">ì •ë¬¼í™”</option>
                                    <option value="ì¶”ìƒí™”">ì¶”ìƒí™”</option>
                                    <option value="ì¼ëŸ¬ìŠ¤íŠ¸">ì¼ëŸ¬ìŠ¤íŠ¸</option>
                                    <option value="ë””ì§€í„¸ì•„íŠ¸">ë””ì§€í„¸ì•„íŠ¸</option>
                                    <option value="ìŠ¤ì¼€ì¹˜">ìŠ¤ì¼€ì¹˜</option>
                                    <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                                </select>
                            </div>
                        </div>

                        <!-- ì¬ë£Œ ë° ê¸°ë²• -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h6 class="text-primary mb-3">
                                    <i class="fas fa-palette me-1"></i>ì¬ë£Œ ë° ê¸°ë²•
                                </h6>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="medium" class="form-label">ì£¼ìš” ì¬ë£Œ</label>
                                <select class="form-select" id="medium" name="medium">
                                    <option value="">ì¬ë£Œ ì„ íƒ</option>
                                    <option value="ì˜¤ì¼íŒŒìŠ¤í…”">ì˜¤ì¼íŒŒìŠ¤í…”</option>
                                    <option value="ìœ í™”">ìœ í™”</option>
                                    <option value="ì½˜í…Œ">ì½˜í…Œ</option>
                                    <option value="ê³¼ìŠˆ">ê³¼ìŠˆ</option>
                                    <option value="ì—°í•„">ì—°í•„</option>
                                    <option value="ìƒ‰ì—°í•„">ìƒ‰ì—°í•„</option>
                                    <option value="ë™ì–‘í™”ë¬¼ê°">ë™ì–‘í™”ë¬¼ê°</option>
                                    <option value="ì•„ì´íŒ¨ë“œ">ì•„ì´íŒ¨ë“œ (ë””ì§€í„¸)</option>
                                    <option value="ì‹¸ì¸íœ">ì‹¸ì¸íœ</option>
                                    <option value="í˜¼í•©ì¬ë£Œ">í˜¼í•©ì¬ë£Œ</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="size" class="form-label">ì‘í’ˆ í¬ê¸°</label>
                                <input type="text" class="form-control" id="size" name="size" 
                                       placeholder="ì˜ˆ: 40cm x 30cm">
                            </div>
                        </div>

                        <!-- ì‘í’ˆ ì„¤ëª… -->
                        <div class="mb-4">
                            <h6 class="text-primary mb-3">
                                <i class="fas fa-file-text me-1"></i>ì‘í’ˆ ì„¤ëª…
                            </h6>
                            <label for="description" class="form-label">ìƒì„¸ ì„¤ëª…</label>
                            <textarea class="form-control" id="description" name="description" rows="4"
                                      placeholder="ì‘í’ˆì— ëŒ€í•œ ì„¤ëª…, ì œì‘ ë°°ê²½, ì˜ë„ ë“±ì„ ììœ ë¡­ê²Œ ì‘ì„±í•´ì£¼ì„¸ìš”..."></textarea>
                            <div class="form-text">ì‘í’ˆì˜ ì»¨ì…‰, ì œì‘ ê³¼ì •, ì˜ê° ë“±ì„ í¬í•¨í•´ì£¼ì„¸ìš”.</div>
                        </div>

                        <!-- ì´ë¯¸ì§€ ì—…ë¡œë“œ -->
                        <div class="mb-4">
                            <h6 class="text-primary mb-3">
                                <i class="fas fa-image me-1"></i>ì‘í’ˆ ì´ë¯¸ì§€
                            </h6>
                            <label for="image" class="form-label">ì´ë¯¸ì§€ íŒŒì¼</label>
                            <input type="file" class="form-control" id="image" name="image" 
                                   accept="image/*" onchange="previewImage(this)">
                            <div class="form-text">
                                JPG, PNG, GIF íŒŒì¼ì„ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ìµœëŒ€ 10MB)
                            </div>
                            
                            <!-- ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° -->
                            <div id="imagePreviewContainer" class="mt-3" style="display: none;">
                                <div class="card">
                                    <div class="card-body text-center">
                                        <img id="imagePreview" src="" alt="ë¯¸ë¦¬ë³´ê¸°" 
                                             class="img-fluid rounded" style="max-height: 300px;">
                                        <div class="mt-2">
                                            <button type="button" class="btn btn-sm btn-outline-danger" 
                                                    onclick="removeImage()">
                                                <i class="fas fa-times me-1"></i>ì´ë¯¸ì§€ ì œê±°
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ì¶”ê°€ ì˜µì…˜ -->
                        <div class="mb-4">
                            <h6 class="text-primary mb-3">
                                <i class="fas fa-cog me-1"></i>ì¶”ê°€ ì˜µì…˜
                            </h6>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="is_featured" name="is_featured">
                                        <label class="form-check-label" for="is_featured">
                                            <i class="fas fa-star text-warning me-1"></i>ì£¼ìš” ì‘í’ˆìœ¼ë¡œ ì„¤ì •
                                        </label>
                                        <div class="form-text">ë©”ì¸ í˜ì´ì§€ì— ìš°ì„ ì ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤.</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label for="sort_order" class="form-label">ì •ë ¬ ìˆœì„œ</label>
                                    <input type="number" class="form-control" id="sort_order" name="sort_order" 
                                           value="0" min="0">
                                    <div class="form-text">ìˆ«ìê°€ ì‘ì„ìˆ˜ë¡ ë¨¼ì € í‘œì‹œë©ë‹ˆë‹¤.</div>
                                </div>
                            </div>
                        </div>

                        <!-- ì œì¶œ ë²„íŠ¼ -->
                        <div class="d-flex justify-content-between">
                            <a href="{{ url_for('admin') }}" class="btn btn-outline-secondary">
                                <i class="fas fa-times me-1"></i>ì·¨ì†Œ
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-1"></i>ì‘í’ˆ ì €ì¥
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- ë„ì›€ë§ ì‚¬ì´ë“œë°” -->
        <div class="col-lg-4">
            <!-- ì‘ì„± ê°€ì´ë“œ -->
            <div class="card shadow mb-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-lightbulb me-2"></i>ì‘ì„± ê°€ì´ë“œ
                    </h5>
                </div>
                <div class="card-body">
                    <div class="guide-item mb-3">
                        <h6 class="text-primary">ğŸ“ ì‘í’ˆëª… ì‘ì„± íŒ</h6>
                        <ul class="small text-muted mb-0">
                            <li>ê°„ê²°í•˜ê³  ì˜ë¯¸ìˆëŠ” ì œëª©</li>
                            <li>í•œê¸€/ì˜ë¬¸ ëª¨ë‘ ê°€ëŠ¥</li>
                            <li>íŠ¹ìˆ˜ë¬¸ìëŠ” ìµœì†Œí™”</li>
                        </ul>
                    </div>
                    
                    <div class="guide-item mb-3">
                        <h6 class="text-success">ğŸ¨ ì¬ë£Œë³„ íŠ¹ì§•</h6>
                        <ul class="small text-muted mb-0">
                            <li><strong>ì˜¤ì¼íŒŒìŠ¤í…”:</strong> ë¶€ë“œëŸ½ê³  ì§„í•œ ìƒ‰ê°</li>
                            <li><strong>ìœ í™”:</strong> ê¹Šì´ ìˆëŠ” í‘œí˜„</li>
                            <li><strong>ì½˜í…Œ:</strong> ìì—°ìŠ¤ëŸ¬ìš´ ì§ˆê°</li>
                            <li><strong>ë””ì§€í„¸:</strong> ì •í™•í•˜ê³  ì„ ëª…í•œ í‘œí˜„</li>
                        </ul>
                    </div>
                    
                    <div class="guide-item">
                        <h6 class="text-info">ğŸ“· ì´ë¯¸ì§€ ì—…ë¡œë“œ ê¶Œì¥ì‚¬í•­</h6>
                        <ul class="small text-muted mb-0">
                            <li>í•´ìƒë„: 1200px ì´ìƒ</li>
                            <li>íŒŒì¼ í˜•ì‹: JPG, PNG</li>
                            <li>ì¡°ëª…ì´ ì¢‹ì€ í™˜ê²½ì—ì„œ ì´¬ì˜</li>
                            <li>ì‘í’ˆ ì „ì²´ê°€ ë³´ì´ë„ë¡ êµ¬ì„±</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- ìµœê·¼ ì¶”ê°€ëœ ì‘í’ˆ -->
            <div class="card shadow">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-history me-2"></i>ìµœê·¼ ì¶”ê°€ëœ ì‘í’ˆ
                    </h5>
                </div>
                <div class="card-body">
                    {% if recent_works %}
                    {% for work in recent_works[:3] %}
                    <div class="d-flex align-items-center mb-3">
                        {% if work.image_path %}
                        <img src="{{ url_for('uploaded_file', filename=work.image_path) }}" 
                             class="rounded me-3" style="width: 50px; height: 50px; object-fit: cover;">
                        {% else %}
                        <div class="bg-light rounded me-3 d-flex align-items-center justify-content-center" 
                             style="width: 50px; height: 50px;">
                            <i class="fas fa-image text-muted"></i>
                        </div>
                        {% endif %}
                        <div>
                            <h6 class="mb-1">{{ work.title }}</h6>
                            <small class="text-muted">{{ work.created_at.strftime('%mì›” %dì¼') }}</small>
                        </div>
                    </div>
                    {% endfor %}
                    {% else %}
                    <div class="text-center text-muted">
                        <i class="fas fa-image fa-2x mb-2"></i>
                        <p>ì²« ë²ˆì§¸ ì‘í’ˆì„ ì¶”ê°€í•´ë³´ì„¸ìš”!</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<style>
.guide-item {
    padding: 15px 0;
    border-bottom: 1px solid #eee;
}

.guide-item:last-child {
    border-bottom: none;
}

.form-control:focus,
.form-select:focus {
    border-color: var(--accent-color);
    box-shadow: 0 0 0 0.2rem rgba(231, 76, 60, 0.25);
}

.form-check-input:checked {
    background-color: var(--accent-color);
    border-color: var(--accent-color);
}

.card {
    transition: transform 0.3s ease;
}

.card:hover {
    transform: translateY(-2px);
}

#imagePreviewContainer {
    animation: fadeIn 0.5s ease-in-out;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

@media (max-width: 768px) {
    .container {
        padding: 0 15px;
    }
}
</style>

<script>
// ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° í•¨ìˆ˜
function previewImage(input) {
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        
        reader.onload = function(e) {
            document.getElementById('imagePreview').src = e.target.result;
            document.getElementById('imagePreviewContainer').style.display = 'block';
        };
        
        reader.readAsDataURL(input.files[0]);
        
        // íŒŒì¼ í¬ê¸° ì²´í¬ (10MB)
        if (input.files[0].size > 10 * 1024 * 1024) {
            alert('íŒŒì¼ í¬ê¸°ê°€ 10MBë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤. ë” ì‘ì€ íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
            input.value = '';
            removeImage();
            return;
        }
    }
}

// ì´ë¯¸ì§€ ì œê±° í•¨ìˆ˜
function removeImage() {
    document.getElementById('image').value = '';
    document.getElementById('imagePreviewContainer').style.display = 'none';
    document.getElementById('imagePreview').src = '';
}

// í¼ ì œì¶œ ì²˜ë¦¬
document.getElementById('addWorkForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    // ê¸°ë³¸ ìœ íš¨ì„± ê²€ì‚¬
    const title = document.getElementById('title').value.trim();
    if (!title) {
        alert('ì‘í’ˆëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        document.getElementById('title').focus();
        return;
    }
    
    // ì´ë¯¸ì§€ íŒŒì¼ ì²´í¬
    const imageFile = document.getElementById('image').files[0];
    if (!imageFile) {
        if (!confirm('ì´ë¯¸ì§€ ì—†ì´ ì‘í’ˆì„ ë“±ë¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            return;
        }
    }
    
    // ì œì¶œ ë²„íŠ¼ ìƒíƒœ ë³€ê²½
    const submitBtn = this.querySelector('button[type="submit"]');
    const originalText = submitBtn.innerHTML;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>ì €ì¥ ì¤‘...';
    submitBtn.disabled = true;
    
    // FormData ìƒì„± ë° ì œì¶œ
    const formData = new FormData(this);
    
    fetch(this.action, {
        method: 'POST',
        body: formData
    })
    .then(response => {
        if (response.ok) {
            return response.json();
        }
        throw new Error('Network response was not ok');
    })
    .then(data => {
        if (data.success) {
            alert('ì‘í’ˆì´ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
            window.location.href = '{{ url_for("admin") }}';
        } else {
            alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + (data.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('ì‘í’ˆ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    })
    .finally(() => {
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
    });
});

// ì¹´í…Œê³ ë¦¬ë³„ ì¶”ì²œ ì¬ë£Œ ìë™ ì„ íƒ
document.getElementById('category').addEventListener('change', function() {
    const category = this.value;
    const mediumSelect = document.getElementById('medium');
    
    const recommendations = {
        'í’ê²½í™”': 'ìœ í™”',
        'ì¸ë¬¼í™”': 'ì˜¤ì¼íŒŒìŠ¤í…”',
        'ì •ë¬¼í™”': 'ê³¼ìŠˆ',
        'ì¶”ìƒí™”': 'í˜¼í•©ì¬ë£Œ',
        'ì¼ëŸ¬ìŠ¤íŠ¸': 'ìƒ‰ì—°í•„',
        'ë””ì§€í„¸ì•„íŠ¸': 'ì•„ì´íŒ¨ë“œ',
        'ìŠ¤ì¼€ì¹˜': 'ì—°í•„'
    };
    
    if (recommendations[category] && !mediumSelect.value) {
        mediumSelect.value = recommendations[category];
        
        // ë¶€ë“œëŸ¬ìš´ í•˜ì´ë¼ì´íŠ¸ íš¨ê³¼
        mediumSelect.style.background = '#fff3cd';
        setTimeout(() => {
            mediumSelect.style.background = '';
        }, 1000);
    }
});

// ì œëª© ìë™ ì™„ì„± ë„ìš°ë¯¸
document.getElementById('title').addEventListener('input', function() {
    const title = this.value;
    const category = document.getElementById('category').value;
    const medium = document.getElementById('medium').value;
    
    // ì œëª© ê¸¸ì´ì— ë”°ë¥¸ ê°€ì´ë“œ
    if (title.length > 50) {
        this.style.borderColor = '#ffc107';
        if (!document.querySelector('.title-warning')) {
            const warning = document.createElement('div');
            warning.className = 'form-text text-warning title-warning';
            warning.textContent = 'ì œëª©ì´ ë„ˆë¬´ ê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤. (50ì ì´í•˜ ê¶Œì¥)';
            this.parentNode.appendChild(warning);
        }
    } else {
        this.style.borderColor = '';
        const warning = document.querySelector('.title-warning');
        if (warning) warning.remove();
    }
});

// ì„¤ëª… ê¸€ì ìˆ˜ ì¹´ìš´í„°
const descriptionTextarea = document.getElementById('description');
const maxLength = 500;

descriptionTextarea.addEventListener('input', function() {
    const currentLength = this.value.length;
    
    let counter = this.parentNode.querySelector('.char-counter');
    if (!counter) {
        counter = document.createElement('div');
        counter.className = 'form-text char-counter';
        this.parentNode.appendChild(counter);
    }
    
    counter.innerHTML = `${currentLength}/${maxLength}ì <span class="text-muted">(${maxLength - currentLength}ì ë‚¨ìŒ)</span>`;
    
    if (currentLength > maxLength * 0.9) {
        counter.className = 'form-text char-counter text-warning';
    } else {
        counter.className = 'form-text char-counter text-muted';
    }
});

// í˜ì´ì§€ ì´íƒˆ ë°©ì§€ (ì‘ì„± ì¤‘ì¸ ë‚´ìš©ì´ ìˆì„ ë•Œ)
let formChanged = false;

document.querySelectorAll('#addWorkForm input, #addWorkForm textarea, #addWorkForm select').forEach(element => {
    element.addEventListener('change', () => {
        formChanged = true;
    });
});

window.addEventListener('beforeunload', function(e) {
    if (formChanged) {
        e.preventDefault();
        e.returnValue = '';
        return '';
    }
});

// í¼ ì œì¶œ ì‹œ ì´íƒˆ ë°©ì§€ í•´ì œ
document.getElementById('addWorkForm').addEventListener('submit', function() {
    formChanged = false;
});

// ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì´ë¯¸ì§€ ì—…ë¡œë“œ
const imageInput = document.getElementById('image');
const form = document.getElementById('addWorkForm');

// ë“œë˜ê·¸ ì˜¤ë²„ ì´ë²¤íŠ¸
['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
    form.addEventListener(eventName, preventDefaults, false);
});

function preventDefaults(e) {
    e.preventDefault();
    e.stopPropagation();
}

// ë“œë˜ê·¸ íš¨ê³¼
['dragenter', 'dragover'].forEach(eventName => {
    form.addEventListener(eventName, highlight, false);
});

['dragleave', 'drop'].forEach(eventName => {
    form.addEventListener(eventName, unhighlight, false);
});

function highlight(e) {
    form.classList.add('drag-over');
}

function unhighlight(e) {
    form.classList.remove('drag-over');
}

// ë“œë¡­ ì²˜ë¦¬
form.addEventListener('drop', handleDrop, false);

function handleDrop(e) {
    const dt = e.dataTransfer;
    const files = dt.files;
    
    if (files.length > 0 && files[0].type.startsWith('image/')) {
        imageInput.files = files;
        previewImage(imageInput);
    }
}

// ìë™ ì €ì¥ ê¸°ëŠ¥ (ì„ì‹œ)
let autoSaveInterval;

function startAutoSave() {
    autoSaveInterval = setInterval(() => {
        const formData = new FormData(document.getElementById('addWorkForm'));
        const autoSaveData = {};
        
        for (let [key, value] of formData.entries()) {
            if (key !== 'image') { // ì´ë¯¸ì§€ëŠ” ì œì™¸
                autoSaveData[key] = value;
            }
        }
        
        localStorage.setItem('autoSave_addWork', JSON.stringify(autoSaveData));
        
        // ìë™ ì €ì¥ í‘œì‹œ
        showAutoSaveIndicator();
    }, 30000); // 30ì´ˆë§ˆë‹¤ ìë™ ì €ì¥
}

function showAutoSaveIndicator() {
    const indicator = document.createElement('div');
    indicator.className = 'alert alert-info alert-dismissible fade show position-fixed';
    indicator.style.cssText = 'top: 20px; right: 20px; z-index: 9999; width: auto;';
    indicator.innerHTML = `
        <i class="fas fa-save me-2"></i>ì„ì‹œ ì €ì¥ë¨
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    document.body.appendChild(indicator);
    
    setTimeout(() => {
        if (indicator.parentNode) {
            indicator.remove();
        }
    }, 3000);
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì €ì¥ëœ ë°ì´í„° ë³µì›
document.addEventListener('DOMContentLoaded', function() {
    const autoSaveData = localStorage.getItem('autoSave_addWork');
    if (autoSaveData) {
        try {
            const data = JSON.parse(autoSaveData);
            if (confirm('ì´ì „ì— ì‘ì„±í•˜ë˜ ë‚´ìš©ì´ ìˆìŠµë‹ˆë‹¤. ë³µì›í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                Object.keys(data).forEach(key => {
                    const element = document.getElementById(key);
                    if (element) {
                        if (element.type === 'checkbox') {
                            element.checked = data[key] === 'on';
                        } else {
                            element.value = data[key];
                        }
                    }
                });
            }
            localStorage.removeItem('autoSave_addWork');
        } catch (e) {
            console.error('ìë™ ì €ì¥ ë°ì´í„° ë³µì› ì¤‘ ì˜¤ë¥˜:', e);
        }
    }
    
    startAutoSave();
});

// í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ ìë™ ì €ì¥ ì¤‘ì§€
window.addEventListener('beforeunload', function() {
    if (autoSaveInterval) {
        clearInterval(autoSaveInterval);
    }
});
</script>

<style>
.drag-over {
    background-color: rgba(0, 123, 255, 0.1);
    border: 2px dashed #007bff;
}

.form-floating {
    position: relative;
}

.char-counter {
    text-align: right;
    font-size: 0.875rem;
}

.guide-item ul {
    padding-left: 1rem;
}

.recent-work-item {
    transition: background-color 0.3s ease;
}

.recent-work-item:hover {
    background-color: rgba(0, 0, 0, 0.05);
    border-radius: 8px;
}
</style>
{% endblock %}